<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ParticleDA.jl · ParticleDA</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><script src="../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ParticleDA</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>ParticleDA.jl</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Example:-tsunami-modelling-with-the-bootstrap-filter"><span>Example: tsunami modelling with the bootstrap filter</span></a></li><li><a class="tocitem" href="#Output"><span>Output</span></a></li><li><a class="tocitem" href="#Running-in-Parallel"><span>Running in Parallel</span></a></li><li><a class="tocitem" href="#Testing"><span>Testing</span></a></li><li><a class="tocitem" href="#License"><span>License</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ParticleDA.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ParticleDA.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ParticleDA.jl"><a class="docs-heading-anchor" href="#ParticleDA.jl">ParticleDA.jl</a><a id="ParticleDA.jl-1"></a><a class="docs-heading-anchor-permalink" href="#ParticleDA.jl" title="Permalink"></a></h1><p><a href="https://github.com/Team-RADDISH/ParticleDA.jl"><code>ParticleDA.jl</code></a> is a Julia package to run data assimilation with particle filter distributed using MPI.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>To install the package, open <a href="https://docs.julialang.org/en/v1/stdlib/REPL/">Julia&#39;s REPL</a>, enter the package manager with <code>]</code>, then run the command</p><pre><code class="nohighlight hljs">add https://github.com/Team-RADDISH/ParticleDA.jl.git</code></pre><p>If you plan to develop the package (make changes, submit pull requests, etc), in the package manager mode run this command</p><pre><code class="nohighlight hljs">dev https://github.com/Team-RADDISH/ParticleDA.jl.git</code></pre><p>This will automatically clone the repository to your local directory <code>~/.julia/dev/ParticleDA</code>.</p><p>You can exit from the package manager mode by pressing <code>CTRL + C</code> or, alternatively, the backspace key when there is no input in the prompt.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>After installing the package, you can start using it in Julia&#39;s REPL with</p><pre><code class="language-julia hljs">using ParticleDA</code></pre><p>The run the particle filter you can use the function <code>run_particle_filter</code>:</p><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.run_particle_filter" href="#ParticleDA.run_particle_filter"><code>ParticleDA.run_particle_filter</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">run_particle_filter(init, path_to_input_file::String, filter_type::ParticleFilter)</code></pre><p>Run the particle filter.  <code>init</code> is the function which initialise the model, <code>path_to_input_file</code> is the path to the YAML file with the input parameters. <code>filter_type</code> is the particle filter to use.  See <a href="@ref"><code>ParticleFilter</code></a> for the possible values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L582-L589">source</a></section><section><div><pre><code class="nohighlight hljs">run_particle_filter(init, user_input_dict::Dict, filter_type::ParticleFilter)</code></pre><p>Run the particle filter.  <code>init</code> is the function which initialise the model, <code>user_input_dict</code> is the list of input parameters, as a <code>Dict</code>.  <code>filter_type</code> is the particle filter to use.  See <a href="@ref"><code>ParticleFilter</code></a> for the possible values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L611-L618">source</a></section></article><p>The next section details how to write the interface between the model and the particle filter.</p><h3 id="Interfacing-the-model"><a class="docs-heading-anchor" href="#Interfacing-the-model">Interfacing the model</a><a id="Interfacing-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Interfacing-the-model" title="Permalink"></a></h3><p>The model needs to define a custom data structure and a few functions, that will be used by <a href="#ParticleDA.run_particle_filter"><code>run_particle_filter</code></a>:</p><ul><li><p>a custom structure which holds the data about the model.  This will be used to dispatch the methods to be defined, listed below;</p></li><li><p>an initialisation function with the following signature:</p><pre><code class="language-julia hljs">init(model_params_dict, nprt_per_rank, my_rank) -&gt; model_data</code></pre><p>The arguments are</p><ul><li><code>model_params_dict</code>: the dictionary with the parameters of the model</li><li><code>nprt_per_rank</code>: the number or particle per each MPI rank</li><li><code>my_rank</code>: the value of the current MPI rank</li></ul><p>This initialisation function must create an instance of the model data structure and return it.</p></li><li><p>the model needs to extend the following methods, using the custom model data structure for dispatch:</p></li></ul><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.get_grid_size" href="#ParticleDA.get_grid_size"><code>ParticleDA.get_grid_size</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.get_grid_size(model_data) -&gt; NTuple{N, Int} where N</code></pre><p>Return a tuple with the dimensions (number of nodes) of the grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L19-L23">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.get_n_state_var" href="#ParticleDA.get_n_state_var"><code>ParticleDA.get_n_state_var</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.get_n_state_var(model_data) -&gt; Int</code></pre><p>Return the number of state variables.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L38-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.get_particles" href="#ParticleDA.get_particles"><code>ParticleDA.get_particles</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.get_particle(model_data) -&gt; particles</code></pre><p>Return the vector of particles.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.  Note: this function should return the vector of particles itself and not a copy, because it will be modified in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L59-L66">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.get_truth" href="#ParticleDA.get_truth"><code>ParticleDA.get_truth</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.get_truth(model_data) -&gt; truth_observations</code></pre><p>Return the vector of true observations.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L77-L82">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.update_truth!" href="#ParticleDA.update_truth!"><code>ParticleDA.update_truth!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.update_truth!(model_data, nprt_per_rank::Int) -&gt; truth_observations</code></pre><p>Update the true observations using the dynamic of the model and return the vector of the true observations.  <code>nprt_per_rank</code> is the number of particles per each MPI rank.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L95-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.update_particle_dynamics!" href="#ParticleDA.update_particle_dynamics!"><code>ParticleDA.update_particle_dynamics!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.update_particle_dynamics!(model_data, nprt_per_rank::Int)</code></pre><p>Update the particles using the dynamic of the model.  <code>nprt_per_rank</code> is the number of particles per each MPI rank.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L105-L111">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.update_particle_noise!" href="#ParticleDA.update_particle_noise!"><code>ParticleDA.update_particle_noise!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.update_particle_noise!(model_data, nprt_per_rank::Int)</code></pre><p>Update the particles using the noise of the model and return the vector of the particles.  <code>nprt_per_rank</code> is the number of particles per each MPI rank.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L114-L121">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.get_particle_observations!" href="#ParticleDA.get_particle_observations!"><code>ParticleDA.get_particle_observations!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.get_particle_observations!(model_data, nprt_per_rank::Int) -&gt; particles_observations</code></pre><p>Return the vector of the particles observations.  <code>nprt_per_rank</code> is the number of particles per each MPI rank.  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L124-L130">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.write_snapshot" href="#ParticleDA.write_snapshot"><code>ParticleDA.write_snapshot</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParticleDA.write_snapshot(output_filename, model_data, avg_arr, var_arr, weights, it)</code></pre><p>Write a snapshot of the data after an update of the particles to the HDF5 file <code>output_filename</code>.  <code>avg_arr</code> is the array of the mean of the particles, <code>var_arr</code> is the array of the standard deviation of the particles, <code>weights</code> is the array of the weigths of the particles, <code>it</code> is the index of the time step (<code>it==0</code> is the initial state, before moving forward the model for the first time).  This method is intended to be extended by the user with the above signature, specifying the type of <code>model_data</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/ParticleDA.jl#L133-L143">source</a></section></article><h3 id="Input-parameters"><a class="docs-heading-anchor" href="#Input-parameters">Input parameters</a><a id="Input-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Input-parameters" title="Permalink"></a></h3><p>You can store the input parameters in an YAML file with the following structure</p><pre><code class="language-yaml hljs">filter:
  key1: value1

model:
  model_name1:
    key2: value2
    key3: value3
  model_name2:
    key4: value4
    key5: value5</code></pre><p>The parameters under <code>filter</code> are related to the particle filter, under <code>model</code> you can specify the parameters for different models.</p><p>The particle filter parameters are saved in the following data structure:</p><article class="docstring"><header><a class="docstring-binding" id="ParticleDA.Default_params.FilterParameters" href="#ParticleDA.Default_params.FilterParameters"><code>ParticleDA.Default_params.FilterParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Parameters()</code></pre><p>Parameters for ParticleDA run. Keyword arguments:</p><ul><li><code>master_rank</code> : Id of MPI rank that performs serial computations</li><li><code>n_time_step::Int</code> : Number of time steps. On each time step we update the forward model forecast, get model observations, and weight and resample particles.</li><li><code>verbose::Bool</code> : Flag to control whether to write output</li><li><code>output_filename::String</code> : Name of output file</li><li><code>nprt::Int</code> : Number of particles for particle filter</li><li><code>weight_std</code>: Standard deviation of the distribution of the weights</li><li><code>random_seed::Int</code> : Seed number for the pseudorandom number generator</li><li><code>enable_timers::Bool</code> : Flag to control run time measurements</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/src/params.jl#L5-L18">source</a></section></article><h2 id="Example:-tsunami-modelling-with-the-bootstrap-filter"><a class="docs-heading-anchor" href="#Example:-tsunami-modelling-with-the-bootstrap-filter">Example: tsunami modelling with the bootstrap filter</a><a id="Example:-tsunami-modelling-with-the-bootstrap-filter-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-tsunami-modelling-with-the-bootstrap-filter" title="Permalink"></a></h2><p>A full example of a model interfacing <code>ParticleDA</code> is available in <code>test/model/model.jl</code>.  This model represents a tsunami and is partly based on the <a href="https://github.com/tktmyd/tdac">tsunami data assimilation code</a> by Takuto Maeda.  You can run it with</p><pre><code class="language-julia hljs"># Load ParticleDA
using ParticleDA

# Save some variables for later use
test_dir = joinpath(dirname(pathof(ParticleDA)), &quot;..&quot;, &quot;test&quot;)
module_src = joinpath(test_dir, &quot;model&quot;, &quot;model.jl&quot;)
input_file = joinpath(test_dir, &quot;integration_test_1.yaml&quot;)

# Instantiate the test environment
using Pkg
Pkg.activate(test_dir)
Pkg.instantiate()

# Include the sample model source code and load it
include(module_src)
using .Model

# Run the particle filter using the `init` file defined in the `Model` module.
run_particle_filter(Model.init, input_file, BootstrapFilter())</code></pre><h3 id="Parameters-of-the-test-model"><a class="docs-heading-anchor" href="#Parameters-of-the-test-model">Parameters of the test model</a><a id="Parameters-of-the-test-model-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters-of-the-test-model" title="Permalink"></a></h3><p>The <a href="#Input-parameters">Input parameters</a> section shows how to pass the input parameters for the filter and the model.  For the model included in the test suite, called <code>llw2d</code>, you can set the following parameters:</p><article class="docstring"><header><a class="docstring-binding" id="Main.Model.ModelParameters" href="#Main.Model.ModelParameters"><code>Main.Model.ModelParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ModelParameters()</code></pre><p>Parameters for the model. Keyword arguments:</p><ul><li><code>nx::Int</code> : Number of grid points in the x direction</li><li><code>ny::Int</code> : Number of grid points in the y direction</li><li><code>x_length::AbstractFloat</code> : Domain size (m) in the x direction</li><li><code>y_length::AbstractFloat</code> : Domain size (m) in the y direction</li><li><code>dx::AbstractFloat</code> : Distance (m) between grid points in the x direction</li><li><code>dy::AbstractFloat</code> : Distance (m) between grid points in the y direction</li><li><code>n_state_var::Int</code>: Number of variables in the state vector</li><li><code>nobs::Int</code> : Number of observation stations</li><li><code>station_filename::String</code> : Name of input file for station coordinates</li><li><code>station_distance_x::Float</code> : Distance between stations in the x direction [m]</li><li><code>station_distance_y::Float</code> : Distance between stations in the y direction [m]</li><li><code>station_boundary_x::Float</code> : Distance between bottom left edge of box and first station in the x direction [m]</li><li><code>station_boundary_y::Float</code> : Distance between bottom left edge of box and first station in the y direction [m]</li><li><code>n_integration_step::Int</code> : Number of sub-steps to integrate the forward model per time step.</li><li><code>time_step::AbstractFloat</code> : Time step length (s)</li><li><code>state_prefix::String</code> : Prefix of the time slice data groups in output</li><li><code>title_da::String</code> : Suffix of the data assimilated data group in output</li><li><code>title_syn::String</code> : Suffix of the true state data group in output</li><li><code>title_grid::String</code> : Name of the grid data group in output</li><li><code>title_stations::String</code> : Name of the station coordinates data group in output</li><li><code>title_params::String</code> : Name of the parameters data group in output</li><li><code>peak_position::Vector{AbstractFloat}</code> : The [x,y] coordinates (m) of the initial wave peak</li><li><code>peak_height::AbstractFloat</code> : The height (m) of the initial wave peak</li><li><code>source_size::AbstractFloat</code> : Cutoff distance (m) from the peak for the initial wave</li><li><code>bathymetry_setup::AbstractFloat</code> : Bathymetry set-up.</li><li><code>lambda::AbstractFloat</code> : Length scale for Matérn covariance kernel in background noise</li><li><code>nu::AbstractFloat</code> : Smoothess parameter for Matérn covariance kernel in background noise</li><li><code>sigma::AbstractFloat</code> : Marginal standard deviation for Matérn covariance kernel in background noise</li><li><code>lambda_initial_state::AbstractFloat</code> : Length scale for Matérn covariance kernel in initial state of particles</li><li><code>nu_initial_state::AbstractFloat</code> : Smoothess parameter for Matérn covariance kernel in initial state of particles</li><li><code>sigma_initial_state::AbstractFloat</code> : Marginal standard deviation for Matérn covariance kernel in initial state of particles</li><li><code>padding::Int</code> : Min padding for circulant embedding gaussian random field generator</li><li><code>primes::Int</code>: Whether the size of the minimum circulant embedding of the covariance matrix can be written as a product of small primes (2, 3, 5 and 7). Default is <code>true</code>.</li><li><code>particle_initial_state::String</code> : Initial state of the particles before noise is added. Possible options are<ul><li>&quot;zero&quot; : initialise height and velocity to 0 everywhere</li><li>&quot;true&quot; : copy the true initial state</li></ul></li><li><code>absorber_thickness_fraction::Float</code> : Thickness of absorber for sponge absorbing boundary conditions, fraction of grid size</li><li><code>boundary_damping::Float</code> : damping for boundaries</li><li><code>cutoff_depth::Float</code> : Shallowest water depth</li><li><code>obs_noise_std::Float</code>: Standard deviation of noise added to observations of the true state</li><li><code>particle_dump_file::String</code>: file name for dump of particle state vectors</li><li><code>particle_dump_time::Int</code>: list of (one more more) time steps to dump particle states</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/3b309bdbb6e7efbfba6ac85a08343562f8737882/test/model/model.jl#L13-L60">source</a></section></article><h3 id="Observation-Station-Coordinates"><a class="docs-heading-anchor" href="#Observation-Station-Coordinates">Observation Station Coordinates</a><a id="Observation-Station-Coordinates-1"></a><a class="docs-heading-anchor-permalink" href="#Observation-Station-Coordinates" title="Permalink"></a></h3><p>The coordinates of the observation stations can be set in two different ways. Either way, the parameter <code>nobs</code> should be set to the total number of observation stations.</p><ol><li><p>Provide the coordinates in an input file. Set the parameter <code>station_filename</code> to the name of your input file. The input file is in plain text, the format is one row per station containing x, y - coordinates in metres. Here is a simple example with two stations</p><pre><code class="language-julia hljs"># Comment lines starting with &#39;#&#39; will be ignored by the code
# This file contains two stations: at [1km, 1km] and [2km, 2km]
1.0e3, 1.0e3
2.0e3, 2.0e3</code></pre></li><li><p>Provide parameters for an array of observation stations. The values of these parameters should be set:</p><pre><code class="language-julia hljs">station_distance_x : Distance between stations in the x direction [m]
station_distance_y : Distance between stations in the y direction [m]
station_boundary_x : Distance between bottom left edge of box and first station in the x direction [m]
station_boundary_y : Distance between bottom left edge of box and first station in the y direction [m]</code></pre><p>As an example, one could set</p><pre><code class="language-julia hljs">nobs : 4
station_distance_x : 1.0e3
station_distance_y : 1.0e3
station_boundary_x : 10.0e3
station_boundary_y : 10.0e3</code></pre><p>to generate 4 stations at <code>[10km, 10km]</code>, <code>[10km, 11km]</code>, <code>[11km, 10km]</code> and <code>[11km, 11km]</code>. Note that when using this method, the square root of <code>nobs</code> has to be an integer.</p></li></ol><h2 id="Output"><a class="docs-heading-anchor" href="#Output">Output</a><a id="Output-1"></a><a class="docs-heading-anchor-permalink" href="#Output" title="Permalink"></a></h2><p>If the particle filter parameter <code>verbose</code> is set to <code>true</code>, <a href="#ParticleDA.run_particle_filter"><code>run_particle_filter</code></a> will produce an HDF5 file in the run directory. The file name is <code>particle_da.h5</code> by default. The file contains the true and assimilated ocean height, particle weights, parameters used, and other metadata at each data assimilation time step. To read the output file, use the <a href="https://www.hdfgroup.org/solutions/hdf5/">HDF5 library</a>.</p><p>A basic plotting tool is provided in a <a href="https://github.com/Team-RADDISH/ParticleDA.jl/blob/master/extra/Plot_tdac_output.ipynb">jupyter notebook</a>. This is intended as a template to build more sophisticated postprocessing tools, but can be used for some simple analysis. Set the variable <code>timestamp</code> in the third cell to plot different time slices from the output file. More functionality may be added as the package develops.</p><h2 id="Running-in-Parallel"><a class="docs-heading-anchor" href="#Running-in-Parallel">Running in Parallel</a><a id="Running-in-Parallel-1"></a><a class="docs-heading-anchor-permalink" href="#Running-in-Parallel" title="Permalink"></a></h2><p>The particle state update is parallelised using both MPI and threading. According to our preliminary tests both methods work well at small scale. To use the threading, set the environment variable <code>JULIA_NUM_THREADS</code> to the number of threads you want to use before starting julia and then call the <a href="#ParticleDA.run_particle_filter"><code>run_particle_filter</code></a> function normally. You can check the number of threads julia has available by calling in Julia&#39;s REPL</p><pre><code class="language-julia hljs">Threads.nthreads()</code></pre><p>To use the MPI parallelisation, write a julia script that calls the <code>tdac()</code> function and run it in an unix shell with</p><pre><code class="language-bash hljs">mpirun -np &lt;your_number_of_processes&gt; julia &lt;your_julia_script&gt;</code></pre><p>Note that the parallel performance may vary depending on the performance of the algorithm. In general, a degeneracy of the particle weights will lead to poor load balance and parallel performance. See <a href="https://github.com/Team-RADDISH/ParticleDA.jl/issues/115#issuecomment-675468511">this issue</a> for more details.</p><h2 id="Testing"><a class="docs-heading-anchor" href="#Testing">Testing</a><a id="Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Testing" title="Permalink"></a></h2><p>We have a basic test suite for <code>ParticleDA.jl</code>.  You can run the tests by entering the package manager mode in Julia&#39;s REPL with <code>]</code> and running the command</p><pre><code class="nohighlight hljs">test ParticleDA</code></pre><h2 id="License"><a class="docs-heading-anchor" href="#License">License</a><a id="License-1"></a><a class="docs-heading-anchor-permalink" href="#License" title="Permalink"></a></h2><p>The <code>ParticleDA.jl</code> package is licensed under the MIT &quot;Expat&quot; License.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Thursday 27 January 2022 11:54">Thursday 27 January 2022</span>. Using Julia version 1.7.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
